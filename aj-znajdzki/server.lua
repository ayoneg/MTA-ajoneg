--[[
    By AjonEG <ajonoficjalny@gmail.com> @ 2021 (c)
	Wszelkie prawa zastrzeżone.
	
	Uniwersalny skrypt znajdywania przedmiotów.
]]--

-- lista urzędów
local znajdz = {
--	x,y,z
{69.951171875, 1221.9814453125, 18.807243347168},
{14.884765625, 1238.615234375, 19.333045959473},
{-64.0966796875, 1234.9462890625, 22.44026184082},
{-167.9208984375, 1030.396484375, 19.734413146973},
{-216.8974609375, 1072.36328125, 25.799928665161},
{-334.5224609375, 1056.18359375, 19.739168167114},
{-395.1201171875, 1246.05078125, 6.6739616394043},
{-333.7421875, 1294.990234375, 53.664344787598},
{-341.392578125, 1547.291015625, 75.5625},
{-350.1142578125, 1603.5703125, 80.961013793945},
{-329.048828125, 1860.8994140625, 44.3828125},
{-648.7216796875, 2153.3203125, 60.3828125},
{-801.1396484375, 2264.84375, 58.622253417969},
{-1319.2607421875, 2541.81640625, 87.601699829102},
{-1126.3984375, 2690.0361328125, 54.443702697754},
{-1375.171875, 2639.587890625, 54.595363616943},
{-1477.8115234375, 2640.734375, 58.787948608398},
{-1715.861328125, 2564.298828125, 104.78392791748},
{-1930.2373046875, 2598.4052734375, 61.2265625},
{-1957.4443359375, 2598.0810546875, 62.563026428223},
{-2005.1640625, 2553.5, 65.7265625},
{-2145.1064453125, 2577.7138671875, 134.25257873535},
{-2300.3740234375, 2825.2509765625, 181.03625488281},
{-2845.0185546875, 2801.2021484375, 243.48454284668},
{-2506.9033203125, 2366.6181640625, 5.0535440444946},
{-2401.220703125, 2358.2890625, 6.6753511428833},
{-2185.544921875, 2417.15234375, 5.1897964477539},
{-2422.6865234375, 2220.08203125, 5.4921875},
{-2501.5224609375, 2286.56640625, 4.984375},
{-2617.7431640625, 2239.2373046875, 4.984375},
{-2666.322265625, 2312.1357421875, 23.773170471191},
{-2825.16015625, 2178.421875, 177.78646850586},
{-2704.5341796875, 2069.4580078125, 67.472625732422},
{-2682.451171875, 1934.3994140625, 3.2226257324219},
{-2679.8955078125, 1597.5185546875, 3.2226257324219},
{-2685.625, 1416.3603515625, 7.1015625},
{-2659.7568359375, 1459.435546875, 49.682113647461},
{-2611.25, 1227.8828125, 50.080837249756},
{-2302.5361328125, 1097.865234375, 79.985046386719},
{-2440.5791015625, 937.5869140625, 45.419639587402},
{-2643.197265625, 844.1533203125, 62.279556274414},
{-2726.376953125, 791.2353515625, 53.015625},
{-2654.6865234375, 792.6181640625, 49.9765625},
{-2705.7900390625, 376.099609375, 4.9683799743652},
{-2575.80078125, 266.0537109375, 12.762431144714},
{-2559.8896484375, 322.9375, 16.68902015686},
{-2532.1396484375, 307.865234375, 35.1171875},
{-2367.2431640625, 337.740234375, 35.164970397949},
{-2042.564453125, 307.66015625, 46.2578125},
{-2063.3427734375, 259.673828125, 35.555553436279},
{-2134.6103515625, 185.3828125, 42.25},
{-2077.4150390625, 85.9921875, 32.5},
{-2132.6416015625, -43.4951171875, 35.3203125},
{-2146.5546875, -91.6083984375, 41.59659576416},
{-2357.6318359375, -114.2138671875, 35.3203125},
{-2460.3310546875, -14.5576171875, 28.339023590088},
{-2538.4208984375, -6.6083984375, 25.6171875},
{-2573.302734375, -2.35546875, 8.015625},
{-2748.09375, -131.5205078125, 6.4327402114868},
{-2773.8154296875, -89.806640625, 7.19504737854},
{-2895.685546875, -176.8505859375, 3.9751484394073},
{-2784.5380859375, -264.453125, 7.1875},
{-2550.5068359375, -304.0556640625, 26.285034179688},
{-2441.48828125, -291.54296875, 39.726638793945},
{-2378.0537109375, -264.2783203125, 41.341331481934},
{-2277.2314453125, -376.58203125, 67.51921081543},
{-2382.4697265625, -576.751953125, 132.1171875},
{-2538.7333984375, -714.501953125, 139.3203125},
{-2539.103515625, -597.09765625, 132.7109375},
{-2023.021484375, -483.0654296875, 38.734375},
{-1925.8994140625, -434.9873046875, 25.171875},
{-1738.5439453125, -443.0703125, 1.9609375},
{-1730.611328125, -617.4931640625, 14.1484375},
{-1730.478515625, -698.744140625, 7.4536972045898},
{-1722.654296875, -887.9990234375, 72.477676391602},
{-1528.7490234375, -948.275390625, 182.57717895508},
{-1432.62890625, -964.3330078125, 200.96450805664},
{-1051.203125, -593.3173828125, 32.0078125},
{-941.18359375, -542.68359375, 25.953638076782},
{-944.470703125, -398.578125, 23.207534790039},
{-633.71875, -486.8486328125, 30.276128768921},
{-510.7744140625, -434.3291015625, 29.008884429932},
{-420.671875, -389.8544921875, 16.66556930542},
{-387.822265625, -412.1259765625, 16.203125},
{-261.2548828125, -776.70703125, 2.872631072998},
{-58.9130859375, -386.3876953125, 6.4285583496094},
{-106.7880859375, -299.650390625, 1.4296875},
{25.9248046875, -260.7197265625, 9.4733219146729},
{60.374801635742, -182.56973266602, 1.6535439491272},
{167.73828125, -225.1640625, 1.578125},
{209.947265625, -230.7939453125, 1.778618812561},
{270.287109375, -127.2919921875, 2.9272294044495},
{247.154296875, -53.7568359375, 1.5776442289352},
{221.4091796875, 108.1611328125, 3.890625},
{52, 34.48046875, 1.4454517364502},
{-87.2734375, -30.1669921875, 6.484375},
{-96.4736328125, 3.0673828125, 6.140625},
{-72.8291015625, 173.974609375, 2.8884572982788},
{-432.11328125, 48.5556640625, 42.391162872314},
{-440.9267578125, -47.23828125, 59.299858093262},
{-435.7197265625, -61.3369140625, 58.875},
{-535.4482421875, -177.4658203125, 78.404663085938},
{-551.740234375, -196.8369140625, 78.40625},
{-566.08203125, -177.3564453125, 78.40625},
{-589.4814453125, -173.978515625, 79.731384277344},
{-631.3984375, -139.04296875, 67.144676208496},
{-764.0458984375, -116.23046875, 66.594398498535},
{-937.2607421875, -114.0576171875, 57.687561035156},
{-981.0771484375, -207.1923828125, 48.185920715332},
{-978.478515625, -332.4521484375, 36.7109375},
{-103.0029296875, 1368.5830078125, 10.2734375},
{-162.5859375, 1451.7001953125, 22.841522216797},
{-140.0546875, 1610.158203125, 16.123453140259},
{-98.0576171875, 1837.521484375, 17.184577941895},
{-10.0859375, 2333.2431640625, 24.140625},
{-97.5380859375, 2636.6357421875, 36.330966949463},
{-213.44140625, 2717.8232421875, 62.6875},
{-262.45703125, 2793.39453125, 62.6875},
{-583.5341796875, 2614.8173828125, 53.515625},
{-640.7021484375, 2717.921875, 72.375},
{-685.0048828125, 2706.3173828125, 69.410827636719},
{-799.9814453125, 2776.392578125, 45.930870056152},
{-881.134765625, 2766.748046875, 46},
{-939.7607421875, 2641.5791015625, 42.349597930908},
{-869.2373046875, 2309.0546875, 161.37272644043},
{-874.3994140625, 2306.2236328125, 99.601821899414},
{-772.6767578125, 2423.91796875, 157.09127807617},
{-819.6328125, 2659.2578125, 96.99488067627},
{-410.37890625, 2262.2744140625, 42.4296875},
{-281.716796875, 2048.771484375, 59.650352478027},
{261.3896484375, 1470.7685546875, 10.5859375},
{451.4541015625, 1428.3349609375, 5.4176530838013},
{543.71875, 1556.4755859375, 1},
{593.6220703125, 1237.1005859375, 11.71875},
{498.75, 1109.126953125, 14.673342704773},
{493.828125, 965.78515625, 21.903917312622},
{491.9287109375, 810.703125, -0.62702178955078},
{490.564453125, 780.7138671875, -22.041683197021},
{1137.9248046875, 734.71875, 10.81880569458},
{1392.0986328125, 944.2802734375, 10.8203125},
{1491.2236328125, 1109.5419921875, 14.822175979614},
{1687.1845703125, 1013.55859375, 11.1994972229},
{1906.9609375, 1010.3154296875, 10.812696456909},
{2099.478515625, 885.8095703125, 10.81298828125},
{2150.0537109375, 1219.1640625, 10.812850952148},
{2110.99609375, 1278.7568359375, 10.812841415405},
{2099.8759765625, 1349.044921875, 10.812841415405},
{2181.568359375, 1479.1240234375, 11.060683250427},
{2516.7890625, 1568.1376953125, 11.555979728699},
{2863.5478515625, 1600.376953125, 10.8203125},
{2819.83984375, 2021.3916015625, 10.8203125},
{2926.970703125, 2100.1396484375, 17.895481109619},
{2791.9619140625, 2264.8115234375, 14.661463737488},
{2667.1015625, 2327.7802734375, 10.8203125},
{2616.3056640625, 2454.1533203125, 14.8671875},
{2749.0439453125, 2483.2314453125, 11.0625},
{2742.5224609375, 2633.12109375, 10.8203125},
{2809.7783203125, 2942.9462890625, 34.771961212158},
{2374.330078125, 2797.8349609375, 13.105983734131},
{2191.7861328125, 2732.810546875, 10.8203125},
{2059.9990234375, 2706.287109375, 10.8203125},
{1867.0732421875, 2613.9736328125, 11.0234375},
{1777.599609375, 2678.013671875, 10.8203125},
{1698.9189453125, 2881.142578125, 10.8359375},
{1579.287109375, 2863.9443359375, 10.826429367065},
{1488.5205078125, 2773.2841796875, 10.8203125},
{1433.9091796875, 2651.083984375, 11.392612457275},
{1262.25, 2644.7666015625, 10.8203125},
{1251.294921875, 2561.2314453125, 10.8203125},
{1156.0283203125, 2531.8232421875, 10.8203125},
{914.6845703125, 2445.38671875, 10.8203125},
{855.353515625, 2407.2197265625, 19.797658920288},
{1092.5458984375, 2103.05078125, 15.350400924683},
{974.6513671875, 2057.953125, 10.8203125},
{844.10314941406, 1997.5393066406, 11.864062309265},
{761.8408203125, 2044.9716796875, 6.7109375},
{710.78515625, 1985.375, 3.4653990268707},
{783.40234375, 1700.8779296875, 5.28125},
{952.30078125, 1769.8427734375, 8.8515625},
{1025.32421875, 1720.453125, 10.8203125},
{1302.380859375, 1676.6337890625, 10.8203125},
{1734.1142578125, 1792.92578125, 10.8203125},
{1901.9873046875, 1726.7109375, 10.8203125},
{1998.0390625, 1520.6083984375, 17.0625},
{2150.638671875, 1726.541015625, 11.046875},
{2303.1337890625, 1871.5048828125, 10.8203125},
{2296.2021484375, 1981.091796875, 31.779651641846},
{2308.5087890625, 2037.044921875, 10.8203125},
{2378.283203125, 2011.451171875, 11.15625},
{2475.3876953125, 1920.9599609375, 10.882786750793},
{2639.103515625, 2040.76953125, 10.953125},
{2490.76171875, 2397.6259765625, 10.8203125},
{2493.1083984375, 2396.9150390625, 4.2109375},
{2473.583984375, 2336.505859375, 10.8203125},
{2351.55078125, 2445.4873046875, 14.681238174438},

}

local tick = 55 
local used = {}

function wybierz(number) -- zwraca wylosowany punkt
	for i,z in ipairs(znajdz) do
		if i == number then
			return z
		end
	end
	return false
end

function delALL() -- remove all
	local pick = getElementsByType("pickup")
	for i,z in ipairs(pick) do
		local znaj = getElementData(z,"znajdz") or false;
		if znaj then
			destroyElement(z)
		end
	end
end

function updatehere()
	tick = 5 
	used = {}
	delALL()
	setTimer(respZnajdz, 1000, 1)
end

function respZnajdz()
--	local timehour, timeminute = getTime()
	if tick <= 0 then return end
	local rng = math.random(1,#znajdz)
	local wyb = wybierz(rng)
	if wyb and not used[rng] then
--		outputChatBox(tick..". Wybieram: "..rng,root)
		
		local znja = createPickup(wyb[1], wyb[2], wyb[3], 3, 1274, 1500)
		setElementData(znja,"znajdz",true)
		setElementData(znja,"znajdz:id",rng)
		setElementData(znja,"znajdz:code","UP-1")
		
		tick = tick - 1
		used[rng] = true
		return respZnajdz()
	else
		return respZnajdz()
	end
end


addEventHandler("onPickupHit", getRootElement(),function(gracz)
    if (getElementType(gracz) == "player") then
		local uid = getElementData(gracz,"player:dbid") or 0;
		if uid > 0 then
			if isPedInVehicle(gracz) then return end
			local znaj = getElementData(source,"znajdz") or false;
			if znaj then
				local znajId = getElementData(source,"znajdz:id") or 0;
				if znajId > 0 then
					local code = getElementData(source,"znajdz:code") or false;
--					code = "UP-1" -- (ukryte przedmioty ew. 1)
					local result2 = exports["aj-dbcon"]:wyb("SELECT * FROM server_jobslog WHERE joblog_code=? AND joblog_value=1 AND joblog_userid=? AND joblog_type=?",code,uid,znajId)
					if result2 and #result2 > 0 then
						outputChatBox("Już wcześniej odnalazłeś tą ukrytą nagrodę.", gracz)
					else
--						outputChatBox("Gratulacje odnalazłeś ukrytą nagrodę!", gracz)
						if code == "UP-1" then
							-- CODE NOTI encode
							-- kod UP-1 nagroda w postaci KASY
							local result3 = exports["aj-dbcon"]:wyb("SELECT * FROM server_jobslog WHERE joblog_code=? AND joblog_value=1 AND joblog_userid=?",code,uid)
							ilosc = #result3
							ilosc = ilosc + 1
							ilosc = ilosc * 100;
							ilosc = ilosc * 4.50;
							--spmoneu
							money = getPlayerMoney(gracz)
							razem = money + ilosc;
							if razem > 99999999 then
								outputChatBox("Masz za dużo gotówki przy sobie, aby odebrać nagrodę!", gracz, 255, 0, 0)
								return
							end
							givePlayerMoney(gracz,ilosc)
							local query = exports["aj-dbcon"]:upd("UPDATE server_users SET user_money=user_money+? WHERE user_id=?",ilosc,uid)
						end
						local query = exports["aj-dbcon"]:upd("INSERT INTO server_jobslog SET joblog_code=?, joblog_data=NOW(), joblog_value=1, joblog_type=?, joblog_userid=?",code,znajId,uid)
						money = string.format("%.2f", ilosc/100)
						outputChatBox("Gratulacje odnalazłeś ukrytą nagrodę otrzymujesz #388E00+"..money.."$#e7d9b0!", gracz, 231, 217, 176, true)
					end
				end
			end
		end
	end
end)


setTimer(updatehere, 1800000, 0) -- 30minut
respZnajdz()